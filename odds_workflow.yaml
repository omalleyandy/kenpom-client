
---

## 1. Market Odds Contract  
**File:** `overtime_ncaab_odds_YYYY-MM-DD.csv`

### Required Columns (v1)

| Column            | Type    | Notes |
|-------------------|---------|------|
| home_team         | string  | Normalized team name |
| away_team         | string  | Normalized team name |
| spread            | float   | Home perspective (negative = home favored) |
| total             | float   | Game total |
| home_ml           | int     | American odds |
| away_ml           | int     | American odds |
| start_time_local  | string  | Local tip time (human-readable) |

### Constraints
- One row per game
- `spread` and `total` must be non-null
- Moneylines may be null **only** if market did not post them

### Drift Signals
- Missing `spread` or `total`
- Multiple rows per matchup
- Team names not matching KenPom conventions

---

## 2. KenPom Ratings Contract  
**File:** `kenpom_ratings_YYYY_YYYY-MM-DD_enriched.csv`

### Required Columns (subset)

| Column        | Type   | Notes |
|---------------|--------|------|
| team          | string | Canonical KenPom team name |
| adj_em        | float  | Adjusted efficiency margin |
| adj_o         | float  | Offensive efficiency |
| adj_d         | float  | Defensive efficiency |
| tempo         | float  | Adjusted tempo |

### Notes
- Archive snapshots are **backtesting-safe**
- Current-season snapshots are **not** backtesting-safe

---

## 3. Game Projections Contract  
**File:** `todays_game_predictions_YYYY-MM-DD.csv`

### Required Columns (v1)

| Column          | Type  | Notes |
|-----------------|-------|------|
| home_team       | string | Must align with odds contract |
| away_team       | string | Must align with odds contract |
| model_spread   | float  | Home perspective |
| model_total    | float  | Projected total |
| win_prob_home  | float  | 0–1 |
| sigma_game     | float  | Game-level variance |

### Constraints
- One row per game
- All numeric fields must be non-null
- `win_prob_home` ∈ [0, 1]

### Drift Signals
- Multiple rows per matchup
- Missing sigma (breaks EV math)
- Team names that fail odds merge

---

## 4. Edge / EV Contract  
**File:** `betting_edge_analysis_YYYY-MM-DD.csv`

### Required Columns (v1)

| Column              | Type   | Notes |
|---------------------|--------|------|
| bet_type            | string | spread / moneyline / total |
| market_line         | float  | From odds |
| model_line          | float  | From projections |
| edge_value          | float  | Model − market |
| ev_pct              | float  | Expected value (%) |
| recommended_stake   | float  | Bankroll fraction (optional) |

### Constraints
- No EV calculation without `sigma_game`
- Stake must be 0 if EV < threshold

---

## Team Name Normalization (Critical)

### Canonical Source
- **KenPom team names are authoritative**

### Common Mismatch Examples
| Source        | Example |
|---------------|---------|
| overtime.ag   | "UNC" |
| KenPom        | "North Carolina" |

### Rules
1. Normalize odds → KenPom
2. Prefer explicit mapping table
3. Fuzzy matching only as last resort
4. **Log when fuzzy matching is used**

If merges fail, **assume naming drift first**, not logic errors.

---

## Drift Detection Checklist

Run when something breaks:

- [ ] File exists and is date-stamped
- [ ] Row count > 0
- [ ] Required columns present
- [ ] No duplicate matchups
- [ ] Team names merge cleanly
- [ ] Numeric fields are non-null
- [ ] Schema version unchanged

If any box fails → **stop pipeline**.

---

## Change Policy

Schema changes require:
1. Version bump in this file
2. Migration notes
3. Script updates
4. Validation step added or updated

No exceptions.

---

## Philosophy

These contracts exist to:
- Stop silent failures
- Make errors obvious
- Preserve research integrity
- Keep pipelines boring and reliable

If a pipeline “works” but violates a contract, it is **broken**.